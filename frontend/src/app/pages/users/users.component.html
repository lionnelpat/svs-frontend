<!-- src/app/pages/users/users.component.html -->
<div class="grid">
    <!-- Statistiques des utilisateurs -->
    <div class="col-12" *ngIf="userStats">
        <div class="grid">
            <div class="col-12 md:col-6 lg:col-3">
                <div class="surface-0 shadow-2 p-3 border-1 border-50 border-round">
                    <div class="flex justify-content-between mb-3">
                        <div>
                            <span class="block text-500 font-medium mb-3">Total Utilisateurs</span>
                            <div class="text-900 font-medium text-xl">{{ userStats.totalUsers }}</div>
                        </div>
                        <div class="flex align-items-center justify-content-center bg-blue-100 border-round"
                             style="width:2.5rem;height:2.5rem">
                            <i class="pi pi-users text-blue-500 text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-12 md:col-6 lg:col-3">
                <div class="surface-0 shadow-2 p-3 border-1 border-50 border-round">
                    <div class="flex justify-content-between mb-3">
                        <div>
                            <span class="block text-500 font-medium mb-3">Utilisateurs Actifs</span>
                            <div class="text-900 font-medium text-xl">{{ userStats.activeUsers }}</div>
                        </div>
                        <div class="flex align-items-center justify-content-center bg-green-100 border-round"
                             style="width:2.5rem;height:2.5rem">
                            <i class="pi pi-check-circle text-green-500 text-xl"></i>
                        </div>
                    </div>
                    <span class="text-green-500 font-medium">{{ getPercentage(userStats.activeUsers, userStats.totalUsers) }}%</span>
                    <span class="text-500"> des utilisateurs</span>
                </div>
            </div>

            <div class="col-12 md:col-6 lg:col-3">
                <div class="surface-0 shadow-2 p-3 border-1 border-50 border-round">
                    <div class="flex justify-content-between mb-3">
                        <div>
                            <span class="block text-500 font-medium mb-3">Comptes Verrouillés</span>
                            <div class="text-900 font-medium text-xl">{{ userStats.lockedUsers }}</div>
                        </div>
                        <div class="flex align-items-center justify-content-center bg-orange-100 border-round"
                             style="width:2.5rem;height:2.5rem">
                            <i class="pi pi-lock text-orange-500 text-xl"></i>
                        </div>
                    </div>
                    <span class="text-orange-500 font-medium" *ngIf="userStats.lockedUsers > 0">Attention requise</span>
                    <span class="text-500" *ngIf="userStats.lockedUsers === 0">Aucun compte verrouillé</span>
                </div>
            </div>

            <div class="col-12 md:col-6 lg:col-3">
                <div class="surface-0 shadow-2 p-3 border-1 border-50 border-round">
                    <div class="flex justify-content-between mb-3">
                        <div>
                            <span class="block text-500 font-medium mb-3">Nouveaux ce mois</span>
                            <div class="text-900 font-medium text-xl">{{ userStats.newUsersThisMonth }}</div>
                        </div>
                        <div class="flex align-items-center justify-content-center bg-cyan-100 border-round"
                             style="width:2.5rem;height:2.5rem">
                            <i class="pi pi-user-plus text-cyan-500 text-xl"></i>
                        </div>
                    </div>
                    <span class="text-cyan-500 font-medium">{{ userStats.newUsersThisMonth }}</span>
                    <span class="text-500"> nouveaux utilisateurs</span>
                </div>
            </div>
        </div>
    </div>

    <!-- En-tête avec actions -->
    <div class="card mb-5">
        <div class="flex flex-col lg:flex-row lg:justify-between lg:align-middle">
            <div class="mb-3 lg:mb-0">
                <div class="flex align-items-center mb-2">
                    <i class="pi pi-users text-blue-600 text-2xl mr-3"></i>
                    <h1 class="text-2xl font-semibold text-blue-900 m-0">Gestion des Utilisateurs</h1>
                </div>
                <p class="text-600 m-0 line-height-3">
                    Suivi et gestion des Utilisateurs
                </p>
            </div>

            <!-- Actions principales -->
            <div class="flex flex-column sm:flex-row gap-2">
                <p-button
                    icon="pi pi-refresh"
                    class="p-button-outlined p-button-primary"
                    pTooltip="Actualiser"
                    tooltipPosition="top"
                    (click)="onRefresh()">
                </p-button>
                <p-button
                    icon="pi pi-plus"
                    label="Nouveau user"
                    (click)="onCreateUser()"
                    class="p-button-primary">
                </p-button>
            </div>
        </div>
    </div>

    <!-- Liste des utilisateurs -->
    <div class="col-12">
        <app-user-list
            [canEdit]="canEditUser"
            [canDelete]="canDeleteUser"
            [canManageRoles]="canManageRoles"
            [isAdmin]="isAdmin"
            [isSuperAdmin]="isSuperAdmin"
            (userEdit)="onEditUser($event)"
            (userDeleted)="onUserDeleted($event)"
            (userSelected)="onUserSelected($event)">
        </app-user-list>
    </div>
</div>

<!-- Dialog pour le formulaire utilisateur -->
<p-dialog
    [(visible)]="showUserForm"
    [header]="isEditMode ? 'Modifier l\'utilisateur' : 'Nouvel utilisateur'"
    [modal]="true"
    [style]="{ width: '90vw', maxWidth: '800px' }"
    [draggable]="false"
    [resizable]="false"
    styleClass="p-fluid"
    (onHide)="onCloseUserForm()">

    <app-user-form
        [user]="selectedUser"
        [isEditMode]="isEditMode"
        [canManageRoles]="canManageRoles"
        (userSaved)="onUserSaved($event)"
        (cancelled)="onCloseUserForm()">
    </app-user-form>
</p-dialog>
