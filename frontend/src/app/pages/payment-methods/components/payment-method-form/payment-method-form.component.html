<p-dialog
    [visible]="visible"
    [style]="{width: '450px'}"
    [header]="dialogTitle"
    [modal]="true"
    [closable]="true"
    [draggable]="false"
    [resizable]="false"
    (onHide)="onHide()"
    styleClass="p-fluid">

    <form [formGroup]="paymentMethodForm" (ngSubmit)="onSubmit()" class="payment-method-form">
        <!-- Section d'informations générales -->
        <div class="formgrid grid mb-4">
            <div class="field col-12">
                <div class="flex align-items-center mb-3">
                    <i class="pi pi-info-circle text-primary mr-2"></i>
                    <span class="text-900 font-semibold">Informations générales</span>
                </div>
            </div>

            <!-- Nom -->
            <div class="field col-12">
                <label for="nom" class="font-semibold">
                    Nom <span class="text-red-500">*</span>
                </label>
                <input
                    id="nom"
                    type="text"
                    pInputText
                    formControlName="nom"
                    placeholder="Ex: Orange Money"
                    [class.ng-invalid]="isFieldInvalid('nom')"
                    [readonly]="isViewMode">

                <small class="p-error block mt-1" *ngIf="isFieldInvalid('nom')">
                    {{ getFieldError('nom') }}
                </small>
            </div>

            <!-- Code -->
            <div class="field col-12">
                <label for="code" class="font-semibold">
                    Code <span class="text-red-500">*</span>
                </label>
                <input
                    id="code"
                    type="text"
                    pInputText
                    formControlName="code"
                    placeholder="Ex: OM"
                    [class.ng-invalid]="isFieldInvalid('code')"
                    [readonly]="isViewMode"
                    style="text-transform: uppercase;">

                <small class="p-error block mt-1" *ngIf="isFieldInvalid('code')">
                    {{ getFieldError('code') }}
                </small>

                <small class="p-info block mt-1" *ngIf="!isFieldInvalid('code')">
                    Code unique en majuscules (2-10 caractères)
                </small>
            </div>

            <div class="grid">
                <div class="col-12">
                    <label for="description" class="field-label">
                        Description <span class="required">*</span>
                    </label>
                    <textarea
                        id="description"
                        pInputTextarea
                        formControlName="description"
                        placeholder="Description détaillée de l'opération..."
                        class="w-full"
                        rows="3"
                        [class.ng-invalid]="isFieldInvalid('description')"
                    ></textarea>
                    <small class="field-error" *ngIf="isFieldInvalid('description')">
                        La description est obligatoire
                    </small>
                </div>
            </div>

            <!-- Statut actif (seulement en mode édition) -->
            <div class="field col-12" *ngIf="mode === 'edit' || mode === 'view'">
                <div class="flex align-items-center">
                    <p-checkbox
                        inputId="actif"
                        formControlName="actif"
                        [binary]="true"
                        [disabled]="isViewMode">
                    </p-checkbox>
                    <label for="actif" class="ml-2 font-semibold">Méthode de paiement active</label>
                </div>
                <small class="text-600 block mt-1">
                    Les méthodes inactives ne sont pas disponibles pour les nouvelles transactions
                </small>
            </div>
        </div>

        <!-- Messages d'erreur globaux -->
        <p-messages
            *ngIf="formErrors.length > 0"
            [value]="formErrors"
            [enableService]="false"
            [closable]="false"
            styleClass="mb-3">
        </p-messages>

        <!-- Actions -->
        <div class="flex justify-content-end gap-2 pt-3 border-top-1 surface-border">
            <p-button
                label="Annuler"
                icon="pi pi-times"
                (onClick)="onCancel()"
                [text]="true"
                severity="secondary">
            </p-button>

            <p-button
                *ngIf="!isViewMode"
                [label]="submitButtonLabel"
                icon="pi pi-check"
                type="submit"
                [loading]="saving"
                [disabled]="paymentMethodForm.invalid || saving">
            </p-button>
        </div>
    </form>
</p-dialog>
