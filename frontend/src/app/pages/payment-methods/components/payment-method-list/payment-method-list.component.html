<div class="payment-method-list">
    <!-- Barre de recherche et filtres -->
    <div class="flex flex-column md:flex-row gap-3 mb-4">
        <!-- Recherche -->
        <div class="flex-1">
            <p-iconfield iconPosition="left">
                <p-inputicon styleClass="pi pi-search"></p-inputicon>
                <input
                    pInputText
                    placeholder="Rechercher par nom, code ou description..."
                    [(ngModel)]="searchQuery"
                    (input)="onSearchChange($event)"
                    class="w-full">
            </p-iconfield>
        </div>
    </div>

    <!-- Message d'erreur -->
    <p-message
        *ngIf="errorMessage"
        severity="error"
        [text]="errorMessage"
        class="mb-4">
    </p-message>

    <!-- Table -->
    <p-table
        [value]="paymentMethods"
        [loading]="loading"
        [paginator]="true"
        [rows]="filter.size"
        [totalRecords]="totalRecords"
        [lazy]="true"
        (onLazyLoad)="onLazyLoad($event)"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Affichage de {first} à {last} sur {totalRecords} méthodes de paiement"
        [rowsPerPageOptions]="[5, 10, 20, 50]"
        styleClass="p-datatable-gridlines"
        [tableStyle]="{'min-width': '50rem'}">

        <!-- Loading template -->
        <ng-template pTemplate="loadingbody">
            <tr>
                <td><p-skeleton></p-skeleton></td>
                <td><p-skeleton></p-skeleton></td>
                <td><p-skeleton></p-skeleton></td>
                <td><p-skeleton></p-skeleton></td>
                <td><p-skeleton></p-skeleton></td>
                <td><p-skeleton></p-skeleton></td>
            </tr>
        </ng-template>

        <!-- Header -->
        <ng-template pTemplate="header">
            <tr>
                <th style="width: 4rem">#</th>
                <th pSortableColumn="nom" style="min-width: 12rem">
                    Nom
                    <p-sortIcon field="nom"></p-sortIcon>
                </th>
                <th pSortableColumn="code" style="min-width: 8rem">
                    Code
                    <p-sortIcon field="code"></p-sortIcon>
                </th>
                <th style="min-width: 15rem">Description</th>
                <th pSortableColumn="actif" style="width: 8rem">
                    Statut
                    <p-sortIcon field="actif"></p-sortIcon>
                </th>
                <th style="width: 10rem">Actions</th>
            </tr>
        </ng-template>

        <!-- Body -->
        <ng-template pTemplate="body" let-paymentMethod let-rowIndex="rowIndex">
            <tr>
                <td>{{ getRowNumber(rowIndex) }}</td>
                <td>
                    <span class="font-semibold text-900">{{ paymentMethod.nom }}</span>
                </td>
                <td>
                            <span class="font-mono text-700 bg-gray-100 px-2 py-1 border-round text-sm">
                                {{ paymentMethod.code }}
                            </span>
                </td>
                <td>
                            <span class="text-700" [title]="paymentMethod.description">
                                {{ paymentMethod.description | slice:0:50 }}
                                <span *ngIf="paymentMethod.description && paymentMethod.description.length > 50">...</span>
                            </span>
                </td>
                <td>
                    <p-tag
                        [value]="paymentMethod.actif ? 'Actif' : 'Inactif'"
                        [severity]="paymentMethod.actif ? 'success' : 'danger'">
                    </p-tag>
                </td>
                <td>
                    <div class="flex gap-2">
                        <p-button
                            icon="pi pi-pencil"
                            (onClick)="editPaymentMethod(paymentMethod)"
                            size="small"
                            [text]="true"
                            severity="secondary"
                            pTooltip="Modifier">
                        </p-button>
                        <p-button
                            icon="pi pi-trash"
                            (onClick)="deletePaymentMethod(paymentMethod)"
                            size="small"
                            [text]="true"
                            severity="danger"
                            pTooltip="Supprimer">
                        </p-button>
                    </div>
                </td>
            </tr>
        </ng-template>

        <!-- Empty state -->
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="6" class="text-center py-6">
                    <div class="flex flex-column align-items-center gap-3">
                        <i class="pi pi-info-circle text-4xl text-400"></i>
                        <span class="text-lg text-600">{{ emptyMessage }}</span>
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>
