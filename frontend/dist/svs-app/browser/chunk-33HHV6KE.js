import{l as c,m as F,n as b}from"./chunk-Y5JEGQKB.js";import{b as h,e as O}from"./chunk-ZXANPB2F.js";import{P as g,U as u,k as d,n as a,w as o}from"./chunk-TX7UWVJS.js";import{a as l,b as m}from"./chunk-EQDQRRRY.js";var E=class i{constructor(r,e,t){this.http=r;this.logger=e;this.errorHandler=t}apiUrl=`${c.apiBaseUrl}/${c.apiVersion}/operations`;DEFAULT_EXCHANGE_RATE=656;getOperations(r={}){this.logger.info("Appel API - Liste des op\xE9rations",r);let e=new h().set("page",r.page?.toString()||"0").set("size",r.size?.toString()||"10").set("sortBy","nom").set("sortDirection","asc");return r.search&&(e=e.set("search",r.search)),r.active!==void 0&&(e=e.set("active",r.active.toString())),this.http.get(this.apiUrl,{params:e}).pipe(a(t=>({operations:t.data.operations,total:t.data.total,page:t.data.page,size:t.data.size})),o(t=>this.handleError(t,"Chargement des op\xE9rations")))}getOperationById(r){return this.http.get(`${this.apiUrl}/${r}`).pipe(a(e=>e.data),o(e=>this.handleError(e,`Chargement op\xE9ration ID: ${r}`)))}createOperation(r){this.logger.info("Cr\xE9ation op\xE9ration",r);let e=m(l({},r),{prixEURO:this.calculateEuroPrice(r.prixXOF,r.prixEURO)});return this.http.post(this.apiUrl,e).pipe(a(t=>t.data),o(t=>this.handleError(t,"Cr\xE9ation op\xE9ration")))}updateOperation(r){this.logger.info("Mise \xE0 jour op\xE9ration",r);let e=m(l({},r),{prixEURO:this.calculateEuroPrice(r.prixXOF,r.prixEURO)});return this.http.put(`${this.apiUrl}/${r.id}`,e).pipe(a(t=>t.data),o(t=>this.handleError(t,`Mise \xE0 jour op\xE9ration ID: ${r.id}`)))}deleteOperation(r){return this.http.delete(`${this.apiUrl}/${r}`).pipe(a(()=>!0),o(e=>this.handleError(e,`Suppression op\xE9ration ID: ${r}`)))}toggleOperationStatus(r){return this.http.patch(`${this.apiUrl}/${r}/toggle-status`,{}).pipe(a(e=>e.data),o(e=>this.handleError(e,`Toggle statut op\xE9ration ID: ${r}`)))}getExchangeRate(){return this.DEFAULT_EXCHANGE_RATE}calculateEuroPrice(r,e){return e!=null&&e>0?e:r>0?Math.round(r/this.getExchangeRate()*100)/100:0}hasValidEuroPrice(r){return r.prixEURO!==void 0&&r.prixEURO!==null&&r.prixEURO>0}getEuroPriceWithFallback(r){return this.hasValidEuroPrice(r)?r.prixEURO:this.calculateEuroPrice(r.prixXOF)}handleError(r,e){let t=r?.error?.message||r.message||"Erreur inconnue";return this.logger.error(`${e} - ${t}`,r),this.errorHandler.handleErrorWithContext(r,e),d(()=>new Error(t))}static \u0275fac=function(e){return new(e||i)(u(O),u(F),u(b))};static \u0275prov=g({token:i,factory:i.\u0275fac,providedIn:"root"})};var R=class i{constructor(r){this.logger=r}static formatCurrency(r,e){let t=i.getSafeAmount(r),n=i.getSafeCurrency(e);try{return n==="XOF"?new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XOF",minimumFractionDigits:0,maximumFractionDigits:0}).format(t).replace("XOF","XOF"):new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}catch{return console.warn("Erreur formatage devise:",{amount:t,currency:n}),i.getFallbackFormat(t,n)}}static formatCurrencyAdvanced(r,e,t={}){let{defaultCurrency:n="XOF",showZeroValues:f=!0,customFormat:v=!1,compactFormat:y=!1}=t,s=i.getSafeAmount(r),p=e?i.getSafeCurrency(e):n;return!f&&s===0?"-":y?i.getCompactFormat(s,p):v?i.getCustomFormat(s,p):i.formatCurrency(s,p)}static getSafeAmount(r){if(r!=null&&typeof r=="number"&&!isNaN(r))return r;if(typeof r=="string"){let e=parseFloat(r);if(!isNaN(e))return e}return 0}static getSafeCurrency(r){if(!r)return"XOF";let e=r.toString().trim().toUpperCase();return["XOF","CFA","FCFA"].includes(e)?"XOF":["EUR","EURO","\u20AC"].includes(e)?"EUR":"XOF"}static getFallbackFormat(r,e){return`${new Intl.NumberFormat("fr-FR",{minimumFractionDigits:e==="XOF"?0:2,maximumFractionDigits:e==="XOF"?0:2}).format(r)} ${e}`}static getCompactFormat(r,e){if(e==="XOF"){if(r>=1e6)return`${(r/1e6).toFixed(1)}M XOF`;if(r>=1e3)return`${(r/1e3).toFixed(0)}K XOF`}return i.formatCurrency(r,e)}static getCustomFormat(r,e){return i.formatCurrency(r,e)}static isValidPrice(r){return r!=null&&typeof r=="number"&&!isNaN(r)&&r>=0}static convertCurrency(r,e,t,n=656){return e===t?r:e==="XOF"&&t==="EUR"?Math.round(r/n*100)/100:Math.round(r*n)}};export{E as a,R as b};
